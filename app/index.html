<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Finalware</title>
        <link rel="stylesheet" href="style.css" />
    </head>

    <body>
        <script src="../src/renderer.js"></script>
        <script>
            let port;
            async function next(){
                checkCom().then(function(result){
                    console.log(result);
                    //for loop that goes trough all the ports and counts the ones that have vendorid 1915
                    var selectedport;
                    var count = 0;
                    for(var i = 0; i < result.length; i++){
                        if(result[i].vendorId == "1915" && result[i].productId == "521F"){
                            count++;
                            //port equals the result.path without "COM"
                            selectedport = result[i];
                        }
                        
                        console.log()
                    }
                    if(count == 1){

                        window.location.href = "found.html";
                        //stringify the port and put it in localstorage
                        console.log(selectedport);
                        localStorage.setItem("port", JSON.stringify(selectedport));
                    }

                    else if(count > 1){
                        document.getElementById("bigger").innerHTML = "Multiple devices found!";

                        document.getElementById("smaller").innerHTML = "There are multiple nrf52480 secure update devices connected to your computer. Please make sure that only one device is connected to your computer and try again.";
                    }

                    
                });
            }
            function found(){
                window.location.href = "found.html";
            }
            //window.onload call next
            window.onload = function(){
                localStorage.clear();
                next();
            }
        </script>
        <div>
            <div id="header">
                <img src="../app/finalmouse-logo.png" alt="log" />
            </div>
            <div id="content">
                <div id="bigger">No device found!</div>
                <div id="smaller">
                    We couldn't find a compatible Device to flash to. Turn off your mouse with the switch on the bottom and reconnect the mouse to
                    the USB cable while pressing the DPI and middle mouse button
                    simultaneously. After that, press the next button.
                </div>
            </div>
        </div>
        <div id="buttons">
            <div>
                <button class="btn" onclick="closeapp()" href="">Exit</button>
            </div>

            <div id="rightbuttons">
                <button class="btn" onclick="next()">Next</button>
            </div>
        </div>
    </body>
</html>
